<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Sname Game</title>
		<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
		<style type="text/css">
		.scope {
			width: 599px;
			height: 599px;
			border: 1px solid blue;
			margin: 0 auto;
		}
		.square {
			/*display:block;*/
			float: left;
			/*clear: left*/;
			border-bottom: 1px solid gray;
			border-right: 1px solid gray;
			width: 19px;
			height: 19px;
		}
		.food {
			background-color: red;
		}
		.snake {
			background-color: blue;
		}
		</style>
		<script type="text/javascript">
		/**
		 * 游戏说明
		 * 方向键：w a s p
		 */
		var cancleInt;
		var previousWhich;
		$(document).ready(function() {
		    init_map();
		    show_snake();
		    setInterval(food_time,5000);
		    //setInterval(move_snake, 200);
		    $("body").keyup(function(event) {
		    	console.log(event.which);
		    	console.log(previousWhich);
		    	//when press other keys,make the keyup skip the next program
		    	if (event.which != 83 && event.which != 87 && event.which != 65 && event.which != 68) {
		    		return false;
		    	}
				//press down key
				if (event.which == 83 && (previousWhich == 68 || previousWhich == 65 || previousWhich == undefined)) {
					window.clearInterval(cancleInt);
					move_snake = function(){
						var start = list[0];
						$.each(list,function(index,value) {
							if ( index == list.length-1) {
								list[index] = value + 30;
								$("#"+list[index]).addClass("snake");
								if ($("#"+list[index]).hasClass("food")) {
									list.unshift(start);
									$("#"+start).addClass("snake");
								}
							}else if(index == 0 ){
								$("#"+value).removeClass("snake");
								list[index] = list[index+1];
							}else {
								list[index] = list[index+1];
							}
						});
					}
					cancleInt = setInterval(move_snake, 200);
				};

				//press up key
				if (event.which == 87 && (previousWhich == 68 || previousWhich == 65)) {
					window.clearInterval(cancleInt);
					move_snake = function(){
						var start = list[0];
						$.each(list,function(index,value) {
							if ( index == list.length-1) {
								list[index] = value-30;
								$("#"+list[index]).addClass("snake");
								if ($("#"+list[index]).hasClass("food")) {
									list.unshift(start);
									$("#"+start).addClass("snake");
								}
							}else if(index == 0 ){
								$("#"+value).removeClass("snake");
								list[index] = list[index+1];
							}else {
								list[index] = list[index+1];
							}
						});
					}
					cancleInt = setInterval(move_snake, 200);
				};

				//press left key
				if (event.which == 65 && (previousWhich == 83 || previousWhich == 87)) {
					window.clearInterval(cancleInt);
					move_snake = function(){
						var start = list[0];
						$.each(list,function(index,value) {
							if ( index == list.length-1) {
								list[index] = value -1;
								$("#"+list[index]).addClass("snake");
								if ($("#"+list[index]).hasClass("food")) {
									list.unshift(start);
									$("#"+start).addClass("snake");
								}
							}else if(index == 0 ){
								$("#"+value).removeClass("snake");
								list[index] = list[index+1];
							}else {
								list[index] = list[index+1];
							}
						});
					}
					cancleInt = setInterval(move_snake, 200);
				};

				//press right key
				if (event.which == 68 && (previousWhich == 83 || previousWhich == 87)) {
					window.clearInterval(cancleInt);
					move_snake = function(){
						var start = list[0];
						$.each(list,function(index,value) {
							if ( index == list.length-1) {
								list[index] = value + 1;
								$("#"+list[index]).addClass("snake");
								if ($("#"+list[index]).hasClass("food")) {
									list.unshift(start);
									$("#"+start).addClass("snake");
								}
							}else if(index == 0 ){
								$("#"+value).removeClass("snake");
								list[index] = list[index+1];
							}else {
								list[index] = list[index+1];
							}
						});
					}
					cancleInt = setInterval(move_snake, 200);
				};
				previousWhich = event.which;
			});
		});
		var list;
		var move;
		//控制地图的生成
		function init_map() {
		    var w = 30; //在水平方向，总共有50个方块
		    var v = 30; //in vertical direction, there is 50 squares.
		    for (var i = 0; i < v; i++) {
		        for (var j = 0; j < w; j++) {
		        	var t = i*30+j+1;
		            if (j == w - 1) {
		                $("#scope").append('<span class="square" style="border-right: 0px solid gray;" id="'+t+'">&nbsp;</span>');
		                continue;
		            };
		            if (i == v - 1) {
		                $("#scope").append('<span class="square" style="border-bottom: 0px solid gray;" id="'+t+'">&nbsp;</span>');
		                continue;
		            };
		            $("#scope").append('<span class="square" style="" id="'+t+'">&nbsp;</span>');
		        }
		    }
		    var foodAddress = Math.round(Math.random()*899+1);
		    $("#"+foodAddress).addClass("food");
		}
		//控制食物出现的地方，和出现时间
		function food_time() {
			$("span.food").removeClass("food");
			var foodAddress = Math.round(Math.random()*899+1);
			if ($("#"+foodAddress).hasClass("snake")) {
				var foodAddress = Math.round(Math.random()*899+1);
			}
			$("#"+foodAddress).addClass("food");
		}

		//控制蛇的初始化
		function show_snake() {
			list = new Array(1,31,61);
			$.each(list, function(index,value) {
				$("#"+value).addClass("snake");
			});
		}

		var move_snake = function(){};

		//开始蛇的运动
		function startMove() {
			cancleInt = setInterval(move_snake,200);
		}

		//暂停蛇的运动
		function pause() {
			window.clearInterval(cancleInt);
		}

		//重置蛇的运动
		function reset() {
		}
		</script>
	</head>
	<body >
		<h2 align="center">Snake game</h2>
		<div class="scope" id="scope" align="center"></div>
		<div class="buttons">
			<input type="button" onclick="startMove()" value="开始">
			<input type="button" onclick="pause()" value="暂停">
			<input type="button" onclick="reset()" value="重置">
		</div>
	</body>
</html>